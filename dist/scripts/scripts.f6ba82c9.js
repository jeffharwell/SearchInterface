"use strict";angular.module("searchInterfaceApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","services.config"]).config(["$routeProvider","$locationProvider",function(a,b){b.html5Mode(!0),a.when("/scenariothree",{templateUrl:"views/scenariothree.html",controller:"ScenarioThreeCtrl",controllerAs:"scenariothree"}).when("/scenariothreelanding",{templateUrl:"views/scenariothreelanding.html",controller:"ScenarioThreeLandingCtrl",controllerAs:"scenariothreelanding"}).when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).otherwise({redirectTo:"/"})}]),angular.module("searchInterfaceApp").controller("MainCtrl",["$routeParams","mturkParameters","$location",function(a,b,c){console.debug(a.assignmentId),console.debug(a.hitId),console.debug(a.workerId),console.debug(a.turkSubmitTo),a.assignmentId&&"undefined"!=typeof a.assignmentId&&b.setParameters(a),b.isPreview()||c.path("/scenariothreelanding")}]),angular.module("searchInterfaceApp").directive("cytoscapeDirective",["$rootScope","$window","mturkParameters","configuration","$http",function(a,b,c,d,e){return{restrict:"E",template:'<div id="cy"></div>',replace:!0,scope:{cyNodes:"=",cyEdges:"=",cyClick:"&"},link:function(f){f.style=cytoscape.stylesheet().selector("node").css({"background-color":"#666",label:"data(name)",width:"label",height:"label",shape:"rectangle"}).selector("edge").css({width:3,"line-color":"#ccc","target-arrow-color":"#ccc","target-arrow-shape":"triangle"}).selector(".background").css({"text-border-color":"#000","text-background-color":"#ccc","text-background-opacity":.75,"text-valign":"center","text-halign":"center"}),f.readyfunc=function(){var a=this;a.elements().unselectify(),a.on("tap","node",function(a){var b=a.cyTarget,c=b.id();f.cyClick({value:c})})},console.debug("doCy called"),f.cy=cytoscape({container:$("#cy"),style:f.style,ready:f.readyfunc,elements:f.cyNodes.concat(f.cyEdges)}),f.params={name:"cola",animate:!0,randomize:!1,fit:!0,nodeSpacing:3,edgeLengthVal:30,maxSimulationTime:1500},f.layout=f.cy.makeLayout(f.params),f.layout.run(),f.cy.nodes().forEach(function(a){var b=a.data("id");a.on("tap",function(){console.debug("Node "+b+" was clicked")})}),a.$on("reloadGraph",function(){console.debug("Reloading the graph!!"),f.layout.stop(),f.cy=cytoscape({container:$("#cy"),style:f.style,ready:f.readyfunc,elements:f.cyNodes.concat(f.cyEdges)}),f.layout=f.cy.makeLayout(f.params),f.layout.run()}),a.$on("appChanged",function(a,b){console.debug("Something changed!!"),f.layout.stop(),b&&b.length>0&&(console.debug("Adding new node"),f.cy.add(b),f.layout=f.cy.makeLayout(f.params)),f.layout.run()}),a.$on("searchInitiated",function(a,b){if(console.debug("Search Initiated, saving search graph to the database"),c.isHit()){console.debug(d.backendurl);var g=d.backendurl+"/recordResults",h={assignmentid:c.getAssignmentId(),hitid:c.getHitId(),workerid:c.getWorkerId(),query:{nodes:f.cy.json(),queryduration:b}};e.post(g,{testdata:h}).then(function(a){console.debug("Got stuff back"),console.debug(a)},function(a){console.debug("Error"),console.debug(a)})}}),angular.element(b).bind("resize",function(){f.cy.resize(),f.layout.run()})}}}]),angular.module("searchInterfaceApp").directive("focusMe",function(){return{scope:{trigger:"=focusMe"},link:function(a,b){a.$watch("trigger",function(c){c===!0&&(b[0].focus(),a.trigger=!1)})}}}),angular.module("searchInterfaceApp").controller("ScenarioThreeCtrl",["$scope","$rootScope","$location","$anchorScroll","configuration","$http","mturkParameters",function(a,b,c,d,e,f,g){a.disableBtns=function(){a.searchbtnDisabled=!0,a.sobtnDisabled=!0,a.addbtnDisabled=!0,a.resetbtnDisabled=!0,a.addbtnDisabled=!0,a.subDisabled=!0,a.predDisabled=!0,a.objDisabled=!0},a.enableBtns=function(){a.searchbtnDisabled=!1,a.sobtnDisabled=!1,a.addbtnDisabled=!1,a.resetbtnDisabled=!1,a.addbtnDisabled=!1,a.subDisabled=!1,a.predDisabled=!1,a.objDisabled=!1},a.enableBtns(),a.searchbtnDisabled=!0,a.focusSubject=!0,a.queryStart=new Date;var h=[],i=[];a.refresh=function(){console.debug("refreshing the graph"),b.$broadcast("appChanged")},a.reset=function(){console.debug("resetting the graph"),a.nodes=h,a.edges=i,a.searchbtnDisabled=!0,j(),b.$broadcast("reloadGraph")};var j=function(){a.valueToId={},a.nextId=0,a.nodes.forEach(function(b){a.valueToId[b.data.name]=b.data.id,b.data.id>=a.nextId&&(a.nextId=b.data.id+1)})};a.nodes=h,a.edges=i,j();var k=function(b){if(null===b||""===b.trim())return null;if("?"!==b&&b in a.valueToId)return a.valueToId[b];var c=a.nextId++;return a.valueToId[b]=c,console.debug("Assigning id "+c+" to value "+b),c},l=function(a,b){return{data:{id:a,name:b},classes:"background"}},m=function(a,b){return{data:{id:a+"-"+b,source:a,target:b}}};a.search=function(){console.debug("Starting a search");var h=new Date,i=h-a.queryStart;b.$broadcast("searchInitiated",i),a.template="searchresults",a.disableBtns();var j=c.hash();if(c.hash("searchresultscontainer"),d(),c.hash(j),g.isHit()){console.debug(e.backendurl);var k=e.backendurl+"/recordResults",l={assignmentid:g.getAssignmentId(),hitid:g.getHitId(),workerid:g.getWorkerId(),query:{nodes:"node structure",queryduration:15}};f.post(k,{testdata:l}).then(function(a){console.debug("Got stuff back"),console.debug(a)},function(a){console.debug("Error"),console.debug(a)})}},a.addTriple=function(){if(console.debug("Trying to add a triple."),null!==a.triple){var c=k(a.triple.subject),d=k(a.triple.predicate),e=k(a.triple.object),f=[];null!==c&&f.push(l(c,a.triple.subject)),null!==d&&f.push(l(d,a.triple.predicate)),null!==e&&f.push(l(e,a.triple.object)),null!==c&&null!==d&&f.push(m(c,d)),null!==d&&null!==e&&f.push(m(d,e)),f.length>0&&(b.$broadcast("appChanged",f),a.searchbtnDisabled=!1),a.triple.subject="",a.triple.predicate="",a.triple.object=""}}}]),angular.module("searchInterfaceApp").controller("ScenarioThreeLandingCtrl",[function(){console.debug("Scenario 3 Landing Page")}]),angular.module("searchInterfaceApp").directive("goClick",["$location",function(a){return function(b,c,d){var e;d.$observe("goClick",function(a){e=a}),c.bind("click",function(){b.$apply(function(){a.path(e)})})}}]),angular.module("searchInterfaceApp").directive("goQualtrics",["$window","mturkParameters",function(a,b){return function(c,d,e){var f;e.$observe("goQualtrics",function(a){f=a}),d.bind("click",function(){c.$apply(function(){console.debug("You clicked on goQualtrics button"),console.debug(f);var c="&assignmentId="+b.getAssignmentId()+"&hitId="+b.getAssignmentId();c=c+"&workerId="+b.getWorkerId()+"&turkSubmitTo="+b.getTurkSubmitTo(),console.debug(c),a.location.href=f+c})})}}]),angular.module("services.config",[]).constant("configuration",{environment:"production",backendurl:"https://triple2.jeffharwell.com/SearchInterface"}),angular.module("searchInterfaceApp").service("mturkParameters",function(){var a=!1,b=!1,c=!1,d=!1,e=function(e){e.assignmentId&&"undefined"!=typeof e.assignmentId&&(a=e.assignmentId),e.hitId&&"undefined"!=typeof e.hitId&&(b=e.hitId),e.workerId&&"undefined"!=typeof e.workerId&&(c=e.workerId),e.turkSubmitTo&&"undefined"!=typeof e.turkSubmitTo&&(d=e.turkSubmitTo)},f=function(){return a},g=function(){return b},h=function(){return c},i=function(){return d},j=function(){return a&&"ASSIGNMENT_ID_NOT_AVAILABLE"!==a?!0:!1},k=function(){return a&&"ASSIGNMENT_ID_NOT_AVAILABLE"===a?!0:!1};return{setParameters:e,getAssignmentId:f,getHitId:g,getWorkerId:h,getTurkSubmitTo:i,isPreview:k,isHit:j}}),angular.module("searchInterfaceApp").run(["$templateCache",function(a){a.put("views/about.html","<p>This is the about view.</p>"),a.put("views/main.html","<p>You have reached the Claremont Graduate University Search Interface Prototype by Bill Jung and Jeff Harwell</p> <p>At present this site should only be used by following a link from Amazon Mechanical Turk</p> <p>Please return to MTurk and follow the link provided to enter the test site.</p>"),a.put("views/scenariothree.html",'<div class="row"> <div class="col-md-12"> <form class="form-inline"> <div class="form-group"> <label class="sr-only" for="subject">You want</label> <input type="text" class="form-control" ng-model="triple.subject" placeholder="You want" id="subject" focus-me="focusSubject" ng-disabled="subDisabled" autofocus> </div> <div class="form-group"> <label class="sr-only" for="predicate">to find</label> <input type="text" class="form-control" ng-model="triple.predicate" placeholder="to find" id="predicate" ng-disabled="predDisabled"> </div> <div class="form-group"> <label class="sr-only" for="predicate">?</label> <input type="text" class="form-control" ng-model="triple.object" placeholder="?" id="object" ng-disabled="objDisabled"> </div> <button class="btn btn-default" type="button" ng-disabled="addbtnDisabled" ng-click="addTriple(); focusSubject=true">Add Terms!</button> <button class="btn btn-default" type="button" ng-disabled="sobtnDisabled" ng-click="reset(); focusSubject=true">Start Over</button> <button class="btn btn-default" type="button" ng-disabled="searchbtnDisabled" ng-click="search()">Search!</button> </form> </div> <!-- /.col-md-12 --> </div> <!-- // row --> <div class="row"> <div class="col-md-6"> <cytoscape-directive cy-nodes="nodes" cy-edges="edges" cy-new="newnode" cy-click="doClick(value)"></cytoscape-directive> </div> <div class="col-md-6"> <div id="searchresultscontainer"> <ng-include src="template"></ng-include> </div> </div> </div> <div class="row"> <div class="col-md-12"> <button class="btn btn-default" type="button" go-click="/scenariothreelanding">Back to Instructions</button> </div> <div class="col-md-12"> <button class="btn btn-default" type="button" go-qualtrics="https://cgu.co1.qualtrics.com/SE/?SID=SV_0ezQSSqwjAIVBzv">Take the Survey!</button> </div> </div> <script type="text/ng-template" id="searchresults"><h1>Results</h1>\n    <div class="row">\n        <div class="col-md-12">\n        <h4>Asthma Causes - Mayo Clinic</h4>\n        <p>Asthma triggers are different from persson to person and can include: airborn allergens, such as pollen, animal ...</p>\n        <strong>www.mayoclinic.org/diseases/asthma/causes</strong>\n        </div>\n    </div>\n    <div class="row top-buffer">\n        <div class="col-md-12">\n        <h4>What Triggers or Causes Asthma? | AAFA.org</h4>\n        <p>If you have asthma, it is important to keep track of the causes or triggers that you know provoke your asthma ...</p>\n        <strong>www.aafa.org/asthma-triggers.html</strong>\n        </div>\n    </div></script>'),a.put("views/scenariothreelanding.html",'<h1>Welcome to the Claremont Graduate University Search Research Site</h1> <p>Please watch the short instructional video and then continue on to the search site</p> <p>Once you have completed a search you will be presented with a link that will take you to a short survey.</p> <p>After you have completed the survey you will be directed back to Amazon MTurk</p> <div class="row"> <div class="col-md-8"> <iframe width="560" height="315" src="https://www.youtube.com/embed/PZQYLiMbhg8" frameborder="0" allowfullscreen></iframe> </div> <div class="col-md-4"> <p>Proceed to the search site</p> <button class="btn btn-default" type="button" go-click="/scenariothree">Go To Search!</button> </div> </div>')}]);